# ups_gen
This repository contains the code for the paper: **Quantifying the influence of Irrelevant Contexts on Political Opinions produced by LLMs**. The goal of this work is to analyse and quantify the effect of including several types of contexts (ranging from relevant to irrelevant) on the opinions generated by LLMs on political topics extracted from the Political Compass Test (PCT).

To analyse this each of the models considered are prompted to answer to each of the PCT questions independently, with different additional contexts. For each of the additional contexts, several prompts are considered to ensure robustness across various generations. Afterwards, an evaluator model is used to quantify the extent to which the opinion generated by the LLM agrees with the original proposition, allowing for a final computation of the PCT score on both social and economic axis using all the responses generated by the model using the same generation settings (i.e. same prompt template and additional context).
For each additional context a total of 40 scores are obtained by varying in the prompt both the question eliciting the model answer and also the jail-break option guiding the model to take a clear stance during its generation. 

### Obtain model generations and evaluations
The code to obtain the generations and the evaluations is briefly described below.
1. `generate_answers.py`: needed to obtain the models responses to the various PCT questions. It
2. `wright_open_to_close.py`: needed to map the models responses to the discrete options.

```
python generate_answers.py \
  --model_id <HF_MODEL_ID> \
  [--additional_context_key <KEY>] \
  [--jailbreak_option <JAILBREAK_ID>] \
```
Where: 
- `--model_id`: HuggingFace id of the model that is required to produce the generations. 
- `--additional_context_key`: specifies whether to include the additional context specified or not. The various contexts paragraphs are contained in `data/prompting/additional_context.json`. If left empty, the base case without any additional context is used. 
- `--jailreak_option`: specifies which jail-break option to include.

To obtain the PCT results for (WHICH DATA MISSING)
`map_to_pct_axis.py`


For what concerns the notebooks
- `visualize_generated_answers.ipynb`
- `visualize_refusal_to_answer.ipynb`
- `visualize_pct_results.ipynb`
- `visualize_pct_shifts.ipynb`
- `visualize_fit_lmm.ipynb`

### References
[1] PAPER DI WRIGHT
[2] PAPER DI ROTTGER 